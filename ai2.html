<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å—‘ - å¹²æœçˆ±å¥½è€…ç¤¾åŒº</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons Adapter -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }

        #root {
            max-width: 480px;
            margin: 0 auto;
            background-color: #FFF7ED;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Hand-drawn border effect */
        .hand-drawn-border {
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
        }

        /* Animations */
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) translateX(20px) rotate(360deg); opacity: 0; }
        }
        .leaf {
            position: absolute;
            top: -10%;
            animation: fall linear infinite;
            pointer-events: none;
        }
        .leaf:nth-child(1) { left: 10%; animation-duration: 4s; animation-delay: 0s; color: #fb923c; font-size: 20px; }
        .leaf:nth-child(2) { left: 30%; animation-duration: 6s; animation-delay: 1s; color: #d97706; font-size: 16px; }
        .leaf:nth-child(3) { left: 70%; animation-duration: 5s; animation-delay: 2s; color: #ef4444; font-size: 24px; }
        .leaf:nth-child(4) { left: 50%; animation-duration: 7s; animation-delay: 0.5s; color: #f59e0b; font-size: 18px; }
        .leaf:nth-child(5) { left: 85%; animation-duration: 5.5s; animation-delay: 1.5s; color: #fb923c; font-size: 22px; }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .page-enter {
            animation: slideInRight 0.3s ease-out forwards;
        }
        
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }

        /* AI Sparkle Animation */
        @keyframes sparkle {
            0% { opacity: 0; transform: scale(0.5) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }
        .sparkle-icon {
            display: inline-block;
            animation: sparkle 2s infinite ease-in-out;
        }
        
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose ol { list-style-type: decimal; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { color: #d97706; font-weight: 700; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, useMemo, useRef } = React;

        // --- 0. DeepSeek AI Service ---
        // è¿™ä¸€å—ä»£ç è´Ÿè´£è¿æ¥ DeepSeek çš„å¤§è„‘
        const callDeepSeek = async (prompt, systemInstruction = "") => {
            
            // ============================================================
            // ğŸ”´ğŸ”´ğŸ”´ ç¬¬1æ­¥ï¼šåœ¨è¿™é‡Œå¡«å…¥ä½ çš„ DeepSeek API Key ğŸ”´ğŸ”´ğŸ”´
            // ============================================================
            // 1. å» https://platform.deepseek.com/ ç”³è¯· Key
            // 2. Key æ˜¯é•¿è¿™æ ·çš„ï¼šsk-xxxxxxxxxxxxxxxx
            // 3. æŠŠ Key ç²˜è´´åˆ°ä¸‹é¢ä¸¤ä¸ªåŒå¼•å·ä¸­é—´ã€‚
            
            const apiKey = "sk-6eb9968a798340028bdb897810082800";  // ğŸ‘ˆ æŠŠä½ çš„ sk-xxxxxxx ç²˜è´´åˆ°è¿™é‡Œçš„åŒå¼•å·ä¸­é—´ï¼å¦‚æœä¸å¡«ï¼ŒAIåŠŸèƒ½ä¼šæŠ¥é”™ã€‚

            // ============================================================

            const url = "https://api.deepseek.com/chat/completions";
            
            // è¿™æ˜¯å‘ç»™ DeepSeek çš„æ•°æ®åŒ…
            const payload = {
                model: "deepseek-chat", // ä½¿ç”¨ DeepSeek V3 æ¨¡å‹
                messages: [
                    { role: "system", content: systemInstruction }, // è¿™é‡Œå‘Šè¯‰AIå®ƒæ˜¯è°ï¼ˆæ¯”å¦‚è¥å…»å¸ˆï¼‰
                    { role: "user", content: prompt }               // è¿™é‡Œæ˜¯ä½ çš„é—®é¢˜
                ],
                stream: false
            };

            try {
                if (!apiKey) return "âš ï¸ è¯·å…ˆåœ¨ä»£ç ç¬¬125è¡Œå¡«å…¥ DeepSeek API Key æ‰èƒ½ä½¿ç”¨ AI åŠŸèƒ½å“¦ï¼";

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}` // DeepSeek éœ€è¦è¿™ä¸€è¡Œèº«ä»½è¯
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorDetail = await response.text();
                    console.error("API Error:", errorDetail);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                // æå– DeepSeek çš„å›å¤å†…å®¹
                return data.choices?.[0]?.message?.content || "AI æš‚æ—¶å»åƒæ¾æœäº†ï¼Œè¯·ç¨åå†è¯•...";
            } catch (error) {
                console.error("DeepSeek API Error:", error);
                return "ç½‘ç»œå¼€å°å·®äº†ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®æˆ– API Key æ˜¯å¦æ­£ç¡®ã€‚";
            }
        };

        // --- 1. Icons Adapter ---
        const LucideIcon = ({ iconName, size = 24, className, ...props }) => {
            if (!window.lucide?.icons) return null;
            const iconData = window.lucide.icons[iconName];
            if (!iconData) return null;
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                    {iconData.map(([tag, attrs], index) => React.createElement(tag, { ...attrs, key: index }))}
                </svg>
            );
        };
        const createIcon = (name) => (props) => <LucideIcon iconName={name} {...props} />;
        
        // Icons
        const Icons = {
            Search: createIcon('Search'), Bell: createIcon('Bell'), Scan: createIcon('Scan'), MapPin: createIcon('MapPin'),
            MessageCircle: createIcon('MessageCircle'), ThumbsUp: createIcon('ThumbsUp'), Heart: createIcon('Heart'), Share2: createIcon('Share2'),
            Home: createIcon('Home'), ShoppingBag: createIcon('ShoppingBag'), User: createIcon('User'), Calendar: createIcon('Calendar'),
            Leaf: createIcon('Leaf'), Plus: createIcon('Plus'), ChevronRight: createIcon('ChevronRight'), ChevronLeft: createIcon('ChevronLeft'),
            Settings: createIcon('Settings'), HelpCircle: createIcon('HelpCircle'), MessageSquare: createIcon('MessageSquare'),
            Gift: createIcon('Gift'), Truck: createIcon('Truck'), Camera: createIcon('Camera'), X: createIcon('X'),
            Star: createIcon('Star'), Filter: createIcon('Filter'), Edit: createIcon('Edit'), CreditCard: createIcon('CreditCard'),
            CheckCircle: createIcon('CheckCircle'), Map: createIcon('Map'), Sparkles: createIcon('Sparkles'),
            Bot: createIcon('Bot'), Loader2: createIcon('Loader2'), ChefHat: createIcon('ChefHat'), ArrowLeft: createIcon('ArrowLeft')
        };

        // --- 2. Data & Assets ---
        const PLACEHOLDER_URL = (text, bg="FB923C") => `https://placehold.co/400x300/${bg}/FFF?text=${encodeURIComponent(text)}&font=lato`;
        const AVATAR_URL = (text) => `https://placehold.co/100x100/FFCC80/5D4037?text=${encodeURIComponent(text)}`;

        // =========================================================================
        // ğŸ”´ğŸ”´ğŸ”´ ç¬¬2æ­¥ï¼šæ›¿æ¢å›¾ç‰‡åŒºåŸŸ (å‚»ç“œå¼æ“ä½œåŒº) ğŸ”´ğŸ”´ğŸ”´
        // =========================================================================
        
        const MOCK_DB = {
            // ğŸ‘‡ğŸ‘‡ğŸ‘‡ 1. è¿™é‡Œæ˜¯ã€å•†å“åˆ—è¡¨ã€‘çš„å›¾ç‰‡
            products: [
                { 
                    id: 101, 
                    name: "ç‰¹çº§ç¢§æ ¹æœ", 
                    price: 29.9, 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    // ç°åœ¨çš„æ ·å­ï¼šimg: PLACEHOLDER_URL("ç¢§æ ¹æœæ‰‹ç»˜", "EA580C"),
                    // è¦æ”¹æˆï¼š    img: "https://ä½ çš„å›¾ç‰‡ç½‘å€.jpg",
                    // âš ï¸æ³¨æ„ï¼šåŒå¼•å· "" å’Œ é€—å· , åƒä¸‡ä¸èƒ½åˆ ï¼
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANraSfH7W-NlUYB1AYK8OTYYSz8BHIAAloLaxsij0BFHTnmVlEIHu8BAAMCAAN5AAM2BA", 

                    sales: "1.2w", 
                    tags: ["ç§‹æ—¥æ¨è", "æ˜“å‰¥"], 
                    desc: "äº§è‡ªåŒ—ç¾ï¼Œå¥¶é¦™æµ“éƒï¼Œæ‰‹å·¥ç²¾é€‰å¤§æœã€‚" 
                },
                { 
                    id: 102, 
                    name: "æ¯æ—¥åšæœå¤§ç¤¼åŒ…", 
                    price: 89.0, 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANsaSfIRJjCKxEVRXySvIC-OpQNHeEAAlsLaxsij0BFnMpv3xO5tmABAAMCAAN3AAM2BA", 

                    sales: "5k+", 
                    tags: ["çƒ­é”€", "é€ç¤¼"], 
                    desc: "7ç§åšæœæœå¹²ç§‘å­¦é…æ¯”ï¼Œé”ä½æ–°é²œã€‚" 
                },
                { 
                    id: 103, 
                    name: "å¼€å¿ƒæœ (åŸå‘³)", 
                    price: 45.5, 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANtaSfIjBF6TV0ZtxSlSp9y2AoBfbwAAlwLaxsij0BFwlGfg-vOb0sBAAMCAAN5AAM2BA", 

                    sales: "8k+", 
                    tags: ["æ–°å“"], 
                    desc: "è‡ªç„¶å¼€å£ï¼Œæ— æ¼‚ç™½ï¼ŒåŸè‰²åŸé¦™ã€‚" 
                },
                { 
                    id: 104, 
                    name: "æ‰‹å‰¥å·´æ—¦æœ¨", 
                    price: 32.0, 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANuaSfI0HaIeayfd_eRjyyDA29ld4IAAl0Laxsij0BFY1DIarj6YrYBAAMCAAN5AAM2BA", 

                    sales: "2k+", 
                    tags: [], 
                    desc: "å£³è–„å¥½å‰¥ï¼Œä»è‚‰é¥±æ»¡ã€‚" 
                },
            ],

            // ğŸ‘‡ğŸ‘‡ğŸ‘‡ 2. è¿™é‡Œæ˜¯ã€çƒ­é—¨CPã€‘(é¦–é¡µæ¨ªå‘æ»šåŠ¨å¡ç‰‡) çš„å›¾ç‰‡
            cps: [
                { 
                    id: 201, 
                    title: "æä» + è‘¡è„å¹²", 
                    sub: "ç»å…¸é…¸ç”œ", 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANxaShNEw0Mvx7gzASgssV6X-3MsrIAAoYLaxsij0BFI8X4Vhhj7H4BAAMCAAN3AAM2BA", 

                    votes: 1205 
                },
                { 
                    id: 202, 
                    title: "æ ¸æ¡ƒ + é»‘èŠéº»", 
                    sub: "ä¹Œå‘å…»ç”Ÿ", 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANyaShNGSbbphSahtQuk_DewjMMVC4AAocLaxsij0BFFGY89tmasXQBAAMCAAN3AAM2BA", 

                    votes: 980 
                },
                { 
                    id: 203, 
                    title: "è…°æœ + è”“è¶Šè“", 
                    sub: "é¢œå€¼çˆ†è¡¨", 
                    
                    // ğŸ”´ ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAANzaShNm8Qsa7ewqEzURkxRh55PR94AAogLaxsij0BF58_5mZeEeSwBAAMCAAN5AAM2BA", 

                    votes: 856 
                },
            ],

            // ğŸ‘‡ğŸ‘‡ğŸ‘‡ 3. è¿™é‡Œæ˜¯ã€ç£•å‹åœˆ/é¦–é¡µä¿¡æ¯æµã€‘çš„å¸–å­
            feed: [
                { 
                    id: 301, 
                    user: "å…»ç”Ÿå°è¾¾äºº", 
                    
                    // ğŸ”´ (å¤´åƒ) ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    // ç°åœ¨çš„æ ·å­ï¼šavatar: AVATAR_URL("è¾¾äºº"),
                    // è¦æ”¹æˆï¼š    avatar: "https://å¤´åƒç½‘å€.jpg",
                    avatar: AVATAR_URL("è¾¾äºº"), 

                    title: "ç§‹æ—¥æ¶¦è‚ºï¼šç™¾åˆ+æä»", 
                    type: "article", 
                    
                    // ğŸ”´ (å¸–å­å¤§å›¾) ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/cfile/AgACAgEAAyEGAATEcCnBAAN0aShPtNn7DBd-ne-Efu7p2JfYwrgAAooLaxsij0BFT3Z3mvod1UUBAAMCAAN5AAM2BA", 

                    likes: 234, 
                    content: "ç§‹å¤©åˆ°äº†ï¼Œå—“å­å®¹æ˜“å¹²... è¿™å¥—æ­é…äº²æµ‹æœ‰æ•ˆï¼" 
                },
                { 
                    id: 302, 
                    user: "åšæœç»ˆç»“è€…", 
                    
                    // ğŸ”´ (å¤´åƒ) ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    avatar: AVATAR_URL("ç»ˆç»“"), 

                    title: "ç¢§æ ¹æœå‰¥å£³å¤§èµ›å®å†µï¼", 
                    type: "video", 
                    
                    // ğŸ”´ (å¸–å­å¤§å›¾) ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œï¼š
                    img: "https://pic.82314912.xyz/api/rfile/0cda5b1df3964050ca9f3a4b80aeb23d.jpg", 

                    likes: 567, 
                    content: "çœ‹è¿™æ‰‹é€Ÿï¼Œè°æ•¢æ¥æˆ˜ï¼Ÿ" 
                },
            ],
            
            // (æ¶ˆæ¯åˆ—è¡¨ï¼Œä¸€èˆ¬ä¸ç”¨æ”¹)
            messages: [
                { id: 999, user: "âœ¨AI ç£•å­¦é¡¾é—®", msg: "æœ‰ä»€ä¹ˆå…³äºåšæœçš„é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘å“¦~", time: "åˆšåˆš", unread: 0, isAI: true, avatar: "Bot" },
                { id: 401, user: "å®˜æ–¹å°åŠ©æ‰‹", msg: "æ‚¨çš„è®¢å•å·²å‘è´§ï¼Œè¯·æ³¨æ„æŸ¥æ”¶ã€‚", time: "10:00", unread: 0, avatar: "User" },
                { id: 402, user: "ç£•å‹_Lily", msg: "é‚£ä¸ªç¤¼ç›’é“¾æ¥å‘æˆ‘ä¸€ä¸‹å‘—~", time: "æ˜¨å¤©", unread: 1, avatar: "User" },
            ]
        };

        // --- 3. Global State & Navigation Context ---
        const AppContext = createContext();

        const AppProvider = ({ children }) => {
            const [history, setHistory] = useState([{ name: 'Main', tab: 'home', params: {} }]);
            const [cart, setCart] = useState([]);
            const [toast, setToast] = useState(null);

            const currentScreen = history[history.length - 1];
            // Helper for global back button visibility
            const canGoBack = history.length > 1;

            const navigate = (name, params = {}) => {
                setHistory(prev => [...prev, { name, params }]);
            };

            const goBack = () => {
                setHistory(prev => prev.length > 1 ? prev.slice(0, -1) : prev);
            };

            const replaceStack = (name, params = {}) => {
                setHistory([{ name, params }]);
            };

            const showToast = (msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 2000);
            };

            const addToCart = (product) => {
                setCart(prev => {
                    const exist = prev.find(p => p.id === product.id);
                    if(exist) return prev.map(p => p.id === product.id ? {...p, count: p.count+1} : p);
                    return [...prev, {...product, count: 1}];
                });
                showToast("å·²åŠ å…¥è´­ç‰©è½¦ ğŸ›’");
            };

            return (
                <AppContext.Provider value={{ currentScreen, canGoBack, navigate, goBack, replaceStack, cart, addToCart, showToast }}>
                    {children}
                    {toast && (
                        <div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black/80 text-white px-6 py-3 rounded-full z-[100] animate-fade-in flex items-center shadow-2xl">
                            <Icons.Leaf className="w-5 h-5 text-orange-400 mr-2" />
                            {toast}
                        </div>
                    )}
                </AppContext.Provider>
            );
        };

        // --- 4. Shared Components ---
        const Header = ({ title, showBack = true, rightIcon = null, onRightClick }) => {
            const { goBack } = useContext(AppContext);
            return (
                <div className="fixed top-0 w-full max-w-[480px] bg-orange-50/95 backdrop-blur-md z-40 px-4 py-3 flex items-center shadow-sm h-14">
                    {showBack ? (
                        <button onClick={goBack} className="p-1 -ml-2 rounded-full hover:bg-black/5">
                            <Icons.ChevronLeft className="w-6 h-6 text-stone-700" />
                        </button>
                    ) : <div className="w-6" />}
                    <h1 className="flex-1 text-center font-bold text-lg text-stone-800">{title}</h1>
                    <div className="w-6 flex justify-end">
                        {rightIcon && <button onClick={onRightClick}>{rightIcon}</button>}
                    </div>
                </div>
            );
        };

        const Button = ({ children, onClick, variant = "primary", className="", disabled=false }) => {
            const baseStyle = "w-full py-3 rounded-xl font-bold flex items-center justify-center transition-transform active:scale-95 shadow-md disabled:opacity-50 disabled:scale-100";
            const variants = {
                primary: "bg-gradient-to-r from-orange-500 to-amber-600 text-white",
                outline: "border-2 border-orange-500 text-orange-600 bg-transparent",
                ghost: "bg-stone-200 text-stone-700 shadow-none",
                ai: "bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        // --- 5. Feature Screens ---

        // >>> SCREEN: PRODUCT DETAIL
        const ProductDetailScreen = () => {
            const { currentScreen, addToCart, navigate } = useContext(AppContext);
            const { product } = currentScreen.params;
            const [aiRecipe, setAiRecipe] = useState(null);
            const [loadingRecipe, setLoadingRecipe] = useState(false);

            const generateRecipe = async () => {
                setLoadingRecipe(true);
                const prompt = `è¯·ä¸ºâ€œ${product.name}â€ç”Ÿæˆ3ä¸ªåˆ›æ„åƒæ³•æˆ–ç®€æ˜“é£Ÿè°±ã€‚è¦æ±‚ï¼šå†…å®¹æœ‰è¶£ï¼Œé€‚åˆå¹´è½»äººï¼ŒåŒ…å«ä¸€ä¸ªé¥®å“æ­é…ã€‚ä½¿ç”¨Emojiè£…é¥°ã€‚`;
                const system = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¾é£Ÿåˆ›æ„å®¶ï¼Œæ“…é•¿åšæœæ­é…ã€‚å›å¤è¯·ä½¿ç”¨Markdownæ ¼å¼åˆ—è¡¨ã€‚";
                
                // ä½¿ç”¨ DeepSeek æ¥å£
                const result = await callDeepSeek(prompt, system);
                
                setAiRecipe(result);
                setLoadingRecipe(false);
            };

            return (
                <div className="min-h-screen bg-stone-50 pb-24 page-enter">
                    <Header title="å•†å“è¯¦æƒ…" rightIcon={<Icons.Share2 className="w-5 h-5 text-stone-700"/>} />
                    <div className="pt-14">
                        {/* è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯å•†å“å¤§å›¾ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ä½ åœ¨ä¸Šé¢ MOCK_DB é‡Œæ›¿æ¢å¥½çš„å›¾ç‰‡ï¼Œè¿™é‡Œä¸éœ€è¦æ”¹ */}
                        <img src={product.img} className="w-full h-80 object-cover rounded-b-[40px] shadow-lg" alt={product.name} />
                        <div className="px-5 py-6">
                            <div className="flex justify-between items-start mb-2">
                                <h1 className="text-2xl font-bold text-stone-800">{product.name}</h1>
                                <span className="text-2xl font-bold text-orange-600">Â¥{product.price}</span>
                            </div>
                            <div className="flex space-x-2 mb-4">
                                {product.tags.map(t => <span key={t} className="bg-orange-100 text-orange-600 px-2 py-0.5 rounded text-xs">{t}</span>)}
                                <span className="text-xs text-stone-400 mt-1">å·²å”® {product.sales}</span>
                            </div>
                            <p className="text-stone-600 text-sm leading-relaxed mb-6 bg-white p-4 rounded-xl hand-drawn-border border border-stone-200">
                                <span className="font-bold block mb-1">ğŸ¿ï¸ ç£•å­¦å°çŸ¥è¯†ï¼š</span>
                                {product.desc} é€‚åˆç§‹å­£é£Ÿç”¨ï¼Œå»ºè®®æ­é…çº¢èŒ¶ã€‚
                            </p>

                            {/* Gemini AI Recipe Feature */}
                            <div className="mb-6">
                                {!aiRecipe ? (
                                    <Button variant="ai" onClick={generateRecipe} disabled={loadingRecipe}>
                                        {loadingRecipe ? (
                                            <><Icons.Loader2 className="w-5 h-5 animate-spin mr-2" /> æ­£åœ¨è„‘æš´ä¸­...</>
                                        ) : (
                                            <><Icons.Sparkles className="w-5 h-5 mr-2" /> âœ¨ DeepSeek è„‘æ´åƒæ³•</>
                                        )}
                                    </Button>
                                ) : (
                                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-100 shadow-sm animate-fade-in">
                                        <div className="flex justify-between items-center mb-2">
                                            <h3 className="font-bold text-purple-800 flex items-center"><Icons.ChefHat className="w-5 h-5 mr-2"/> AI åˆ›æ„æ¨è</h3>
                                            <button onClick={() => setAiRecipe(null)} className="text-xs text-purple-400">æ”¶èµ·</button>
                                        </div>
                                        <div className="prose prose-sm text-stone-700 max-h-60 overflow-y-auto" dangerouslySetInnerHTML={{ __html: marked.parse(aiRecipe) }}></div>
                                    </div>
                                )}
                            </div>

                            {/* Comments Preview */}
                            <div className="bg-white rounded-2xl p-4 shadow-sm mb-6">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="font-bold">å—‘å‹è¯„ä»· (128)</h3>
                                    <span className="text-xs text-stone-400">æŸ¥çœ‹å…¨éƒ¨ &gt;</span>
                                </div>
                                <div className="flex items-start space-x-3 text-sm">
                                    {/* ğŸ”´ ğŸ”´ ğŸ”´ å•†å“è¯„è®ºåŒºï¼šéšæœºç”¨æˆ·çš„å¤´åƒ ğŸ”´ ğŸ”´ ğŸ”´ */}
                                    {/* æŠŠ AVATAR_URL(...) åˆ æ‰ï¼Œæ¢æˆ "å›¾ç‰‡é“¾æ¥" */}
                                    <img src={AVATAR_URL("User")} className="w-8 h-8 rounded-full" />
                                    <div>
                                        <div className="font-bold text-xs text-stone-500">æ¾é¼ çˆ±åƒæ¾æœ</div>
                                        <p className="text-stone-700 mt-1">åŒ…è£…å¾ˆå¥½ï¼Œæœå­å¾ˆå¤§å¾ˆé¥±æ»¡ï¼Œæ²¡æœ‰åæœï¼</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Bottom Action Bar */}
                    <div className="fixed bottom-0 w-full max-w-[480px] bg-white border-t border-stone-100 p-4 pb-safe flex items-center space-x-4 z-50">
                        <div className="flex flex-col items-center text-stone-500" onClick={() => navigate('Cart')}>
                            <Icons.ShoppingBag className="w-6 h-6" />
                            <span className="text-[10px]">è´­ç‰©è½¦</span>
                        </div>
                        <div className="flex flex-col items-center text-stone-500">
                            <Icons.MessageCircle className="w-6 h-6" />
                            <span className="text-[10px]">å®¢æœ</span>
                        </div>
                        <Button className="flex-1 py-2 rounded-full" onClick={() => addToCart(product)}>åŠ å…¥è´­ç‰©è½¦</Button>
                        <Button className="flex-1 py-2 rounded-full bg-red-500 from-red-500 to-red-600" onClick={() => navigate('Checkout', {items: [product]})}>ç«‹å³è´­ä¹°</Button>
                    </div>
                </div>
            );
        };

        // ... (CartScreen and SearchScreen remain same, no explicit new images to replace) ...
        const CartScreen = () => {
            const { cart, navigate } = useContext(AppContext);
            const total = cart.reduce((acc, item) => acc + item.price * item.count, 0).toFixed(2);

            return (
                <div className="min-h-screen bg-stone-50 pb-32 page-enter">
                    <Header title="æˆ‘çš„è´­ç‰©è½¦" />
                    <div className="pt-16 px-4">
                        {cart.length === 0 ? (
                            <div className="flex flex-col items-center justify-center mt-32 text-stone-400">
                                <Icons.ShoppingBag className="w-16 h-16 mb-4 opacity-50" />
                                <p>è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ~</p>
                                <button onClick={() => navigate('Main')} className="mt-4 px-6 py-2 bg-orange-500 text-white rounded-full">å»é€›é€›</button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {cart.map((item, idx) => (
                                    <div key={idx} className="bg-white p-3 rounded-2xl flex items-center shadow-sm hand-drawn-border">
                                        <div className="w-5 h-5 rounded-full border-2 border-orange-500 flex items-center justify-center mr-3">
                                            <div className="w-3 h-3 bg-orange-500 rounded-full"></div>
                                        </div>
                                        <img src={item.img} className="w-20 h-20 rounded-xl object-cover bg-stone-100" />
                                        <div className="ml-3 flex-1">
                                            <h4 className="font-bold text-stone-800">{item.name}</h4>
                                            <div className="flex justify-between items-center mt-2">
                                                <span className="text-orange-600 font-bold">Â¥{item.price}</span>
                                                <div className="flex items-center space-x-2 bg-stone-100 rounded-lg px-2">
                                                    <button>-</button>
                                                    <span className="text-sm font-medium">{item.count}</span>
                                                    <button>+</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    {cart.length > 0 && (
                        <div className="fixed bottom-0 w-full max-w-[480px] bg-white border-t border-stone-100 p-4 pb-safe flex justify-between items-center shadow-lg z-30">
                            <div>
                                <span className="text-stone-500 text-xs">åˆè®¡:</span>
                                <span className="text-2xl font-bold text-orange-600 ml-1">Â¥{total}</span>
                            </div>
                            <Button className="w-32 py-2 rounded-full" onClick={() => navigate('Checkout', {items: cart})}>å»ç»“ç®—</Button>
                        </div>
                    )}
                </div>
            );
        };

        const SearchScreen = () => {
            const { navigate, goBack } = useContext(AppContext);
            return (
                <div className="min-h-screen bg-stone-50 page-enter">
                    <div className="flex items-center p-3 bg-white shadow-sm">
                        <button onClick={goBack} className="mr-2 p-1 rounded-full active:bg-stone-100">
                             <Icons.ChevronLeft className="w-6 h-6 text-stone-600"/>
                        </button>
                        <div className="flex-1 bg-stone-100 rounded-full flex items-center px-4 py-2 mr-3">
                            <Icons.Search className="w-4 h-4 text-stone-400 mr-2" />
                            <input autoFocus placeholder="æœç´¢ç¢§æ ¹æœ..." className="bg-transparent flex-1 outline-none text-sm" />
                        </div>
                        <button onClick={goBack} className="text-stone-600 text-sm">å–æ¶ˆ</button>
                    </div>
                    <div className="p-4">
                        <h3 className="font-bold text-stone-800 mb-3 flex items-center"><Icons.Leaf className="w-4 h-4 text-orange-500 mr-1"/> çƒ­é—¨æœç´¢</h3>
                        <div className="flex flex-wrap gap-2">
                            {["å¤å¨å¤·æœ", "å‡è‚¥é›¶é£Ÿ", "ç¤¼ç›’", "æ¾å­", "åšæœé…¸å¥¶æ¯"].map(k => (
                                <span key={k} className="px-3 py-1 bg-white border border-stone-200 rounded-full text-xs text-stone-600">{k}</span>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const CheckoutScreen = () => {
            const { replaceStack, showToast } = useContext(AppContext);
            const [paying, setPaying] = useState(false);

            const handlePay = () => {
                setPaying(true);
                setTimeout(() => {
                    setPaying(false);
                    showToast("æ”¯ä»˜æˆåŠŸï¼");
                    replaceStack('PaySuccess');
                }, 2000);
            };

            return (
                <div className="min-h-screen bg-stone-50 pb-24 page-enter">
                    <Header title="ç¡®è®¤è®¢å•" />
                    <div className="pt-16 px-4 space-y-4">
                        {/* Address */}
                        <div className="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between">
                            <div className="flex items-center">
                                <div className="bg-orange-100 p-2 rounded-full mr-3"><Icons.MapPin className="text-orange-600 w-5 h-5" /></div>
                                <div>
                                    <div className="font-bold">æ¾é¼ å¤§ç‹ <span className="text-stone-500 font-normal ml-2">138****8888</span></div>
                                    <div className="text-sm text-stone-500 mt-1">åŒ—äº¬å¸‚æœé˜³åŒºåšæœå¤§é“88å·æ£®æ—å…¬å¯“</div>
                                </div>
                            </div>
                            <Icons.ChevronRight className="text-stone-300" />
                        </div>

                        {/* Items Placeholder */}
                        <div className="bg-white p-4 rounded-2xl shadow-sm">
                            <div className="flex space-x-3 overflow-x-auto hide-scrollbar">
                                {MOCK_DB.products.slice(0,2).map(p => (
                                    <img key={p.id} src={p.img} className="w-16 h-16 rounded-lg bg-stone-100 object-cover" />
                                ))}
                            </div>
                            <div className="text-right text-sm mt-2">å…± 2 ä»¶ï¼Œå°è®¡: <span className="font-bold text-lg text-orange-600">Â¥118.9</span></div>
                        </div>
                    </div>

                    <div className="fixed bottom-0 w-full max-w-[480px] bg-white p-4 shadow-lg border-t border-stone-100 flex justify-end items-center space-x-4">
                        <span className="text-stone-500">å®ä»˜:</span>
                        <span className="text-2xl font-bold text-orange-600">Â¥118.9</span>
                        <Button className="w-32 rounded-full" onClick={handlePay}>
                            {paying ? "æ”¯ä»˜ä¸­..." : "ç«‹å³æ”¯ä»˜"}
                        </Button>
                    </div>
                </div>
            );
        };

        // ... (PaySuccessScreen, MessageScreen, ChatScreen remain same) ...
        const PaySuccessScreen = () => {
            const { replaceStack } = useContext(AppContext);
            return (
                <div className="min-h-screen bg-white flex flex-col items-center justify-center p-8 page-enter">
                    <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6 animate-bounce">
                        <Icons.CheckCircle className="w-12 h-12 text-green-500" />
                    </div>
                    <h2 className="text-2xl font-bold text-stone-800 mb-2">æ”¯ä»˜æˆåŠŸ</h2>
                    <p className="text-stone-500 text-center mb-8">æ‚¨çš„åšæœæ­£åœ¨æ‰“åŒ…ä¸­ï¼Œé¢„è®¡æ˜å¤©å‘è´§ï¼</p>
                    <div className="flex space-x-4 w-full">
                        <Button variant="outline" onClick={() => replaceStack('Main')}>è¿”å›é¦–é¡µ</Button>
                        <Button onClick={() => replaceStack('Main')}>æŸ¥çœ‹è®¢å•</Button>
                    </div>
                </div>
            );
        };

        const MessageScreen = () => {
            const { navigate } = useContext(AppContext);
            return (
                <div className="min-h-screen bg-stone-50 pt-16 page-enter">
                    <Header title="æ¶ˆæ¯ä¸­å¿ƒ" />
                    <div className="px-4 space-y-3">
                        {MOCK_DB.messages.map(m => (
                            <div key={m.id} onClick={() => navigate('Chat', { user: m })} className={`bg-white p-4 rounded-2xl shadow-sm flex items-center active:scale-95 transition-transform ${m.isAI ? 'border-2 border-indigo-100 bg-indigo-50/50' : ''}`}>
                                <div className="relative">
                                    <div className={`w-12 h-12 rounded-full border-2 border-white flex items-center justify-center text-lg ${m.isAI ? 'bg-gradient-to-tr from-indigo-500 to-purple-500 text-white' : 'bg-orange-100 text-stone-800'}`}>
                                        {m.isAI ? <Icons.Bot className="w-7 h-7" /> : m.user[0]}
                                    </div>
                                    {m.unread > 0 && <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] text-white flex items-center justify-center">{m.unread}</div>}
                                </div>
                                <div className="ml-3 flex-1">
                                    <div className="flex justify-between mb-1">
                                        <h4 className={`font-bold ${m.isAI ? 'text-indigo-900 flex items-center' : 'text-stone-800'}`}>
                                            {m.user}
                                            {m.isAI && <Icons.Sparkles className="w-3 h-3 ml-1 text-indigo-500" />}
                                        </h4>
                                        <span className="text-xs text-stone-400">{m.time}</span>
                                    </div>
                                    <p className="text-stone-500 text-sm truncate">{m.msg}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const ChatScreen = () => {
            const { currentScreen, showToast } = useContext(AppContext);
            const { user } = currentScreen.params;
            const [msgs, setMsgs] = useState([
                { me: false, text: user.isAI ? "ä½ å¥½å‘€ï¼æˆ‘æ˜¯ä½ çš„AIå—‘å­¦é¡¾é—®ï¼Œå…³äºåšæœçš„è¥å…»ã€æ­é…ã€é€‰è´­é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘å“¦ï½ ğŸŒ°âœ¨" : "ä½ å¥½å‘€ï¼" }
            ]);
            const [input, setInput] = useState("");
            const [isTyping, setIsTyping] = useState(false);
            const msgEndRef = useRef(null);

            useEffect(() => {
                msgEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [msgs]);

            const send = async () => {
                if(!input.trim()) return;
                const userMsg = input;
                setMsgs(prev => [...prev, { me: true, text: userMsg }]);
                setInput("");
                
                if (user.isAI) {
                    setIsTyping(true);
                    const prompt = userMsg;
                    const systemPrompt = "ä½ æ˜¯ä¸€ä¸ªâ€œå—‘â€APPçš„AIç£•å­¦é¡¾é—®ï¼Œåå­—å«â€œåšæœå°åšå£«â€ã€‚ä½ çš„è¯­æ°”å¹½é»˜é£è¶£ï¼Œå–œæ¬¢ä½¿ç”¨Emojiã€‚ä½ éå¸¸äº†è§£å„ç§åšæœçš„è¥å…»ä»·å€¼ã€é£Ÿç”¨ç¦å¿Œå’Œæ­é…æ–¹æ³•ã€‚è¯·ç®€çŸ­å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚";
                    
                    // ä½¿ç”¨ DeepSeek æ¥å£
                    const responseText = await callDeepSeek(prompt, systemPrompt);
                    
                    setIsTyping(false);
                    setMsgs(prev => [...prev, { me: false, text: responseText }]);
                } else {
                    // Normal simulated reply
                    setTimeout(() => {
                        setMsgs(prev => [...prev, { me: false, text: "æ¨èè¯•è¯•æˆ‘ä»¬çš„ç‰¹çº§ç¢§æ ¹æœå“¦ï¼" }]);
                    }, 1000);
                }
            };

            return (
                <div className="flex flex-col h-screen bg-stone-100 page-enter">
                    <Header title={user.user} />
                    <div className="flex-1 overflow-y-auto p-4 pt-16 space-y-4">
                        {msgs.map((m, i) => (
                            <div key={i} className={`flex ${m.me ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[75%] p-3 rounded-2xl text-sm leading-relaxed ${m.me ? 'bg-orange-500 text-white rounded-tr-none' : 'bg-white text-stone-800 rounded-tl-none shadow-sm'}`}>
                                    {m.me ? m.text : <div dangerouslySetInnerHTML={{ __html: marked.parse(m.text) }} />}
                                </div>
                            </div>
                        ))}
                        {isTyping && (
                            <div className="flex justify-start">
                                <div className="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-stone-400 flex items-center">
                                    <Icons.Loader2 className="w-4 h-4 animate-spin mr-1"/> æ­£åœ¨æ€è€ƒä¸­...
                                </div>
                            </div>
                        )}
                        <div ref={msgEndRef} />
                    </div>
                    <div className="bg-white p-3 pb-safe border-t border-stone-200 flex items-center">
                        <Icons.Plus className="w-6 h-6 text-stone-400 mr-2" />
                        <input value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && send()} placeholder={user.isAI ? "é—®é—®ç¢§æ ¹æœæ€ä¹ˆåƒ..." : "å‘æ¶ˆæ¯..."} className="flex-1 bg-stone-100 rounded-full px-4 py-2 text-sm outline-none mr-2" />
                        <button onClick={send} className="text-orange-600 font-bold px-2">å‘é€</button>
                    </div>
                </div>
            );
        };

        // ... (HomeTab, StoreTab, SocialTab, CheckInTab) ...
        
        // 5.1 ProfileTab (ä¸ªäººä¸­å¿ƒ)
        const ProfileTab = () => {
            const { navigate } = useContext(AppContext);
            return (
                <div className="pb-24 pt-0 min-h-screen bg-stone-50">
                    <div className="bg-orange-50 pt-16 pb-6 px-6 rounded-b-[40px] relative overflow-hidden">
                        <div className="flex items-center space-x-4 relative z-10">
                            {/* ğŸ”´ğŸ”´ğŸ”´ ç¬¬3æ­¥ï¼šæ›¿æ¢ä¸ªäººä¸­å¿ƒå¤´åƒ ğŸ”´ğŸ”´ğŸ”´ 
                                ä¸‹é¢è¿™ä¸€è¡Œï¼ŒæŠŠ AVATAR_URL("Me", "EA580C") æ¢æˆä½ çš„å¤´åƒé“¾æ¥
                                è®°å¾—åŠ åŒå¼•å·ï¼æ¯”å¦‚: src="https://æˆ‘çš„å¤´åƒ.jpg"
                            */}
                            <img src={AVATAR_URL("Me", "EA580C")} className="w-20 h-20 rounded-full border-4 border-white shadow-lg" />
                            
                            <div className="flex-1">
                                <h2 className="text-2xl font-bold text-stone-800 font-[ZCOOL KuaiLe]">æ¾é¼ å¤§ç‹</h2>
                                <p className="text-xs text-stone-500 mt-1 bg-white/50 inline-block px-2 py-1 rounded-full">å—‘é¾„ï¼š312å¤©</p>
                            </div>
                            <Icons.Settings className="w-6 h-6 text-stone-600" onClick={() => showToast("è®¾ç½®")} />
                        </div>
                        <div className="flex justify-between mt-8 px-2 relative z-10 text-center">
                            {[ {l:'å…³æ³¨',v:'128'}, {l:'ç²‰ä¸',v:'3.2k'}, {l:'è·èµ',v:'1.5w'}, {l:'ç§¯åˆ†',v:'880'} ].map(s => (
                                <div key={s.l}><div className="font-bold text-lg">{s.v}</div><div className="text-xs text-stone-400">{s.l}</div></div>
                            ))}
                        </div>
                    </div>
                    
                    {/* ... Rest of ProfileTab ... */}
                    <div className="px-4 -mt-4 relative z-20">
                        <div className="bg-white rounded-2xl p-4 shadow-sm grid grid-cols-4 gap-4 mb-4">
                            {[ {l:'å¾…ä»˜æ¬¾',i:Icons.CreditCard}, {l:'å¾…å‘è´§',i:Icons.Truck}, {l:'å¾…æ”¶è´§',i:Icons.Gift}, {l:'å”®å',i:Icons.MessageSquare} ].map(m => (
                                <div key={m.l} className="flex flex-col items-center" onClick={() => showToast(`æŸ¥çœ‹ ${m.l}`)}>
                                    <m.i className="w-6 h-6 text-stone-700 mb-2" />
                                    <span className="text-xs text-stone-600">{m.l}</span>
                                </div>
                            ))}
                        </div>

                        <div className="bg-white rounded-2xl p-4 shadow-sm">
                            <h3 className="font-bold text-stone-800 mb-4 px-2">å¸¸ç”¨åŠŸèƒ½</h3>
                            <div className="grid grid-cols-4 gap-y-6">
                                {['å—‘å­¦æ¡£æ¡ˆ', 'åšæœè®¸æ„¿', 'é‚»é‡Œåˆ†äº«', 'å® ç‰©ä¸“åŒº', 'å®¢æœä¸­å¿ƒ', 'åœ°å€ç®¡ç†', 'å¸®åŠ©', 'å…³äº'].map((item, idx) => (
                                    <div key={item} className="flex flex-col items-center" onClick={() => showToast(item)}>
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-2 ${idx % 2 === 0 ? 'bg-orange-50 text-orange-500' : 'bg-stone-50 text-stone-500'}`}>
                                            <Icons.Leaf className="w-5 h-5" />
                                        </div>
                                        <span className="text-xs text-stone-600">{item}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const HomeTab = () => {
            const { navigate, addToCart } = useContext(AppContext);
            return (
                <div className="pb-24 pt-28 px-4">
                    {/* ... Header ... */}
                    <div className="fixed top-0 left-0 right-0 max-w-[480px] mx-auto bg-orange-50/95 backdrop-blur-md z-30 px-4 pt-12 pb-2 shadow-sm transition-all">
                        <div className="flex items-center space-x-3">
                            <div onClick={() => navigate('Search')} className="flex-1 h-10 bg-white border border-orange-200 rounded-full flex items-center px-3 shadow-inner active:scale-95 transition-transform">
                                <Icons.Leaf className="w-4 h-4 text-orange-400 mr-2" />
                                <span className="text-sm text-stone-400">æœç´¢åšæœ/CP/è¯é¢˜</span>
                                <Icons.Search className="w-4 h-4 text-stone-400 ml-auto" />
                            </div>
                            <div className="flex space-x-3 text-stone-700">
                                <div onClick={() => navigate('Message')} className="relative"><Icons.Bell className="w-6 h-6"/><span className="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span></div>
                                <Icons.Scan className="w-6 h-6" onClick={() => alert("è°ƒç”¨æ‘„åƒå¤´æ‰«æ...")} />
                                <Icons.MapPin className="w-6 h-6" onClick={() => navigate('Map')} />
                            </div>
                        </div>
                    </div>

                    <div onClick={() => navigate('CheckIn')} className="mt-4 bg-gradient-to-r from-orange-400 to-red-500 rounded-3xl p-5 text-white shadow-lg shadow-orange-200 relative overflow-hidden active:scale-[0.98] transition-transform cursor-pointer hand-drawn-border">
                        <div className="leaf"><Icons.Leaf /></div>
                        <div className="flex items-center justify-between relative z-10">
                            <div>
                                <div className="flex items-center space-x-2 mb-1"><span className="bg-white/20 text-xs px-2 py-0.5 rounded-lg backdrop-blur-sm">ä»Šæ—¥ä¸€ç£•</span></div>
                                <h3 className="text-2xl font-bold mb-1 font-[ZCOOL KuaiLe]">å—‘ç¢§æ ¹æœ</h3>
                                <p className="text-sm opacity-90 flex items-center"><span className="mr-1">ğŸ§ </span> è¡¥å……Omega-3ï¼ˆå‹¿ç‚¹ï¼‰</p>
                            </div>
                            <div className="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-md border border-white/30 text-3xl">ğŸŒ°</div>
                        </div>
                    </div>

                    <div className="mt-6">
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="text-lg font-bold text-stone-800 flex items-center"><span className="w-1 h-4 bg-orange-500 rounded-full mr-2"></span>çƒ­é—¨CP</h3>
                            <Icons.ChevronRight className="w-4 h-4 text-stone-400"/>
                        </div>
                        <div className="flex space-x-4 overflow-x-auto hide-scrollbar pb-4">
                            {MOCK_DB.cps.map((cp, i) => (
                                <div key={cp.id} onClick={() => navigate('ProductDetail', { product: { name: cp.title, price: 58, img: cp.img, tags: ["CP"], sales: "999+", desc: "å®Œç¾æ­é…" } })} className="min-w-[140px] bg-white rounded-2xl p-2 shadow-sm border border-orange-50 relative active:scale-95 transition-transform hand-drawn-border">
                                    <div className="absolute top-0 right-0 p-1"><Icons.Leaf className="w-3 h-3 text-amber-500" /></div>
                                    <img src={cp.img} className="w-full h-24 object-cover rounded-xl mb-2 bg-orange-50" />
                                    <h4 className="text-center text-sm font-bold text-stone-800 truncate">{cp.title}</h4>
                                    <div className="text-center text-[10px] text-orange-500 mt-1 bg-orange-50 rounded-full py-0.5">TOP{i+1} ğŸ”¥ {cp.votes}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="mt-4">
                        <div className="flex space-x-6 border-b border-stone-200 pb-2 mb-4">
                            <span className="text-lg font-bold text-stone-800 border-b-4 border-orange-500 rounded-sm">å—‘å­¦å¹²è´§</span>
                            <span className="text-lg font-medium text-stone-400">é™„è¿‘å—‘å‹</span>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            {MOCK_DB.feed.map((item) => (
                                <div key={item.id} onClick={() => navigate('ProductDetail', { product: { name: item.title, price: 0, img: item.img, tags: [item.type], sales: item.likes, desc: item.content } })} className="bg-white rounded-xl shadow-sm overflow-hidden border border-stone-100 hand-drawn-border">
                                    <img src={item.img} className="w-full h-32 object-cover" />
                                    <div className="p-3">
                                        <h5 className="text-sm font-bold text-stone-800 line-clamp-2 leading-tight mb-2">{item.title}</h5>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center space-x-1">
                                                <img src={item.avatar} className="w-4 h-4 rounded-full"/>
                                                <span className="text-[10px] text-stone-500 truncate max-w-[60px]">{item.user}</span>
                                            </div>
                                            <div className="flex items-center text-[10px] text-stone-400"><Icons.Heart className="w-3 h-3 mr-1"/>{item.likes}</div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const StoreTab = () => {
            const { navigate, addToCart } = useContext(AppContext);
            const [filter, setFilter] = useState('å…¨éƒ¨');
            
            return (
                <div className="pb-24 pt-14 px-4 min-h-screen bg-stone-50">
                    {/* ... Search ... */}
                     <div className="fixed top-0 left-0 right-0 max-w-[480px] mx-auto bg-white z-30 px-4 py-3 flex items-center space-x-3 shadow-sm">
                        <div onClick={() => navigate('Search')} className="flex-1 h-9 bg-stone-100 rounded-full flex items-center px-3">
                            <Icons.Search className="w-4 h-4 text-stone-400 mr-2" />
                            <span className="text-sm text-stone-400">æœç§‹æ—¥é™å®šç¤¼ç›’</span>
                        </div>
                        <div onClick={() => navigate('Cart')} className="relative">
                            <Icons.ShoppingBag className="w-6 h-6 text-stone-700" />
                        </div>
                    </div>

                    <div className="flex space-x-4 overflow-x-auto hide-scrollbar py-4 border-b border-stone-200">
                         {['å…¨éƒ¨', 'CPç»„åˆ', 'å•é¢—åšæœ', 'ç›²ç›’', 'ç¤¼ç›’'].map((cat) => (
                             <button key={cat} onClick={() => setFilter(cat)} className={`flex-shrink-0 px-4 py-1 rounded-full text-sm font-medium transition-colors ${filter === cat ? 'bg-orange-500 text-white shadow-md' : 'bg-white text-stone-600'}`}>
                                 {cat}
                             </button>
                         ))}
                    </div>

                    <div className="grid grid-cols-2 gap-4 mt-4">
                        {MOCK_DB.products.map(p => (
                            <div key={p.id} onClick={() => navigate('ProductDetail', { product: p })} className="bg-white rounded-2xl p-3 shadow-sm flex flex-col active:scale-[0.98] transition-transform hand-drawn-border">
                                <div className="aspect-square rounded-xl mb-3 relative overflow-hidden">
                                    <img src={p.img} className="w-full h-full object-cover" />
                                    {p.tags[0] && <span className="absolute top-2 left-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full shadow-md">{p.tags[0]}</span>}
                                    <button onClick={(e) => { e.stopPropagation(); addToCart(p); }} className="absolute bottom-2 right-2 bg-white p-1.5 rounded-full shadow-md active:scale-90 transition-transform">
                                        <Icons.Plus className="w-4 h-4 text-orange-600" />
                                    </button>
                                </div>
                                <h4 className="text-sm font-bold text-stone-800 mb-1">{p.name}</h4>
                                <div className="flex justify-between items-end mt-auto">
                                    <span className="text-orange-600 font-bold">Â¥{p.price}</span>
                                    <span className="text-[10px] text-stone-400">å·²å”®{p.sales}</span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const SocialTab = () => {
            const { showToast } = useContext(AppContext);
            const [showPublish, setShowPublish] = useState(false);
            const [postContent, setPostContent] = useState("");
            const [generating, setGenerating] = useState(false);

            const aiGeneratePost = async () => {
                if(!postContent.trim()) {
                    showToast("è¯·å…ˆè¾“å…¥ä¸€äº›å…³é”®è¯~");
                    return;
                }
                setGenerating(true);
                const prompt = `æ ¹æ®è¿™äº›å…³é”®è¯ç”Ÿæˆä¸€ç¯‡é€‚åˆå‘åœ¨â€œå¹²æœç¤¾åŒºâ€APPçš„ç§è‰æ–‡æ¡ˆï¼š${postContent}ã€‚è¦æ±‚ï¼šè¯­æ°”æ´»æ³¼å¯çˆ±ï¼Œä½¿ç”¨å¤§é‡Emojiï¼Œç¯‡å¹…çŸ­å°ç²¾æ‚ã€‚`;
                // ä½¿ç”¨ DeepSeek æ¥å£
                const result = await callDeepSeek(prompt);
                setPostContent(result);
                setGenerating(false);
            };

            return (
                <div className="pb-24 pt-14 min-h-screen bg-stone-50 relative">
                     <div className="fixed top-0 w-full max-w-[480px] bg-white z-30 px-4 py-3 flex items-center justify-between shadow-sm">
                        <div className="flex space-x-4 overflow-x-auto hide-scrollbar">
                            <span className="text-lg font-bold text-stone-800">å…³æ³¨</span>
                            <span className="text-lg font-medium text-stone-400">æ¨è</span>
                        </div>
                    </div>

                    <div className="px-4 mt-4 space-y-4">
                         {MOCK_DB.feed.map(item => (
                             <div key={item.id} className="bg-white rounded-2xl p-4 shadow-sm hand-drawn-border">
                                 <div className="flex justify-between items-start mb-3">
                                     <div className="flex items-center space-x-3">
                                         <img src={item.avatar} className="w-10 h-10 rounded-full border border-stone-100" />
                                         <div>
                                             <div className="text-sm font-bold text-stone-800">{item.user}</div>
                                             <div className="text-[10px] text-stone-400">2å°æ—¶å‰</div>
                                         </div>
                                     </div>
                                 </div>
                                 <p className="text-sm text-stone-700 mb-3">{item.content}</p>
                                 <img src={item.img} className="w-full h-48 object-cover rounded-xl mb-3 bg-stone-100" />
                                 <div className="flex justify-between px-4 text-stone-500">
                                     <button className="flex items-center space-x-1" onClick={() => showToast("ç‚¹èµæˆåŠŸ +1 ğŸ’–")}><Icons.Heart className="w-5 h-5" /> <span>{item.likes}</span></button>
                                     <button className="flex items-center space-x-1"><Icons.MessageSquare className="w-5 h-5" /> <span>è¯„è®º</span></button>
                                     <button className="flex items-center space-x-1"><Icons.Share2 className="w-5 h-5" /> <span>è½¬å‘</span></button>
                                 </div>
                             </div>
                         ))}
                    </div>

                    {/* FAB */}
                    <button onClick={() => setShowPublish(true)} className="fixed bottom-24 right-6 w-14 h-14 bg-gradient-to-tr from-orange-500 to-red-500 rounded-full flex items-center justify-center shadow-lg text-white z-30 active:scale-90 transition-transform">
                        <Icons.Plus className="w-8 h-8" />
                    </button>

                    {/* Publish Modal with AI */}
                    {showPublish && (
                        <div className="fixed inset-0 z-50 flex items-end bg-black/50" onClick={() => setShowPublish(false)}>
                            <div className="w-full bg-white rounded-t-3xl p-6 animate-[slideInUp_0.3s_ease-out] flex flex-col h-[60vh]" onClick={e => e.stopPropagation()}>
                                <h3 className="text-center font-bold text-lg mb-4">å‘å¸ƒåŠ¨æ€</h3>
                                
                                <textarea 
                                    className="flex-1 bg-stone-50 rounded-xl p-4 text-sm outline-none resize-none mb-4"
                                    placeholder="åˆ†äº«ä½ çš„ä»Šæ—¥åšæœæ—¶åˆ»... ï¼ˆè¾“å…¥å…³é”®è¯ç‚¹å‡»AIå¸®å†™ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡ˆï¼‰"
                                    value={postContent}
                                    onChange={e => setPostContent(e.target.value)}
                                ></textarea>
                                
                                <div className="flex space-x-3 mb-4">
                                    <Button variant="ai" onClick={aiGeneratePost} disabled={generating} className="flex-1">
                                        {generating ? "AI åˆ›ä½œä¸­..." : "âœ¨ DeepSeek å¸®æˆ‘å†™"}
                                    </Button>

                                    <Button onClick={() => { setShowPublish(false); showToast("å‘å¸ƒæˆåŠŸï¼"); }} className="flex-1">
                                        å‘å¸ƒ
                                    </Button>
                                </div>

                                <div className="flex justify-around border-t border-stone-100 pt-4">
                                    {[
                                        {icon: Icons.Camera, label: "å›¾ç‰‡"},
                                        {icon: Icons.MapPin, label: "ä½ç½®"},
                                        {icon: Icons.Star, label: "è¯é¢˜"}
                                    ].map((opt, i) => (
                                        <div key={i} className="flex flex-col items-center text-stone-400">
                                            <opt.icon className="w-6 h-6 mb-1" />
                                            <span className="text-xs">{opt.label}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const CheckInTab = () => {
             const { showToast } = useContext(AppContext);
             const [checked, setChecked] = useState(false);

             const handleCheckIn = () => {
                 setChecked(true);
                 showToast("æ‰“å¡æˆåŠŸï¼ç§¯åˆ†+10");
             };

             return (
                 <div className="pb-24 pt-0 min-h-screen bg-stone-50">
                     <div className="h-64 bg-stone-800 relative overflow-hidden rounded-b-[40px] shadow-xl">
                        <div className="absolute inset-0 bg-gradient-to-b from-orange-600 to-amber-600 opacity-90"></div>
                        <div className="leaf"><Icons.Leaf /></div>
                        <div className="relative z-10 p-6 pt-12 text-center text-white">
                            <h1 className="text-3xl font-bold mb-1 font-[ZCOOL KuaiLe]">ä»Šæ—¥æŒ‘æˆ˜ï¼šæ‰‹å‰¥æ¾å­</h1>
                            <p className="text-sm opacity-90">å·²åšæŒ 12 å¤© | æˆ˜èƒœ 88% å—‘å‹</p>
                        </div>
                    </div>

                    <div className="relative z-20 -mt-10 px-6">
                        <div className="bg-white rounded-3xl p-8 shadow-lg flex flex-col items-center hand-drawn-border">
                            {!checked ? (
                                <>
                                    <div className="w-24 h-24 rounded-full bg-stone-100 flex items-center justify-center mb-4 border-4 border-dashed border-stone-300">
                                        <Icons.Camera className="w-8 h-8 text-stone-400" />
                                    </div>
                                    <Button onClick={handleCheckIn}>ğŸ“¸ æ‹ç…§æ‰“å¡</Button>
                                </>
                            ) : (
                                <div className="text-center py-4">
                                    <Icons.CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-2" />
                                    <h3 className="text-xl font-bold text-stone-800">ä»Šæ—¥å·²å®Œæˆ</h3>
                                    <p className="text-stone-500 mt-2">å¤ªæ£’äº†ï¼æ˜å¤©ç»§ç»­ä¿æŒï¼</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-8 px-6 grid grid-cols-2 gap-4">
                         {[{t:"å—‘æŠ€PKèµ›", i:"ğŸ†", c:"bg-orange-50"}, {t:"7å¤©æŒ‘æˆ˜", i:"ğŸ“…", c:"bg-blue-50"}, {t:"å‹‹ç« å¢™", i:"ğŸ–ï¸", c:"bg-purple-50"}, {t:"å…‘æ¢å•†åŸ", i:"ğŸ", c:"bg-green-50"}].map(item => (
                             <div key={item.t} onClick={() => showToast(`è¿›å…¥ ${item.t}`)} className={`${item.c} p-4 rounded-2xl flex flex-col items-center justify-center border border-white shadow-sm active:scale-95 transition-transform`}>
                                 <div className="text-3xl mb-2">{item.i}</div>
                                 <span className="font-bold text-stone-700">{item.t}</span>
                             </div>
                         ))}
                    </div>
                 </div>
             );
        };

        const MainApp = () => {
            const { currentScreen, replaceStack, navigate, canGoBack, goBack } = useContext(AppContext);
            const [showSplash, setShowSplash] = useState(true);
            const [activeTab, setActiveTab] = useState('home');

            // Splash Logic
            useEffect(() => {
                const timer = setTimeout(() => setShowSplash(false), 3000);
                return () => clearTimeout(timer);
            }, []);

            if (showSplash) {
                return (
                    <div className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gradient-to-br from-orange-400 via-orange-500 to-amber-600">
                        <div className="leaf"><Icons.Leaf /></div>
                        <div className="text-center animate-bounce mb-8">
                            <span className="text-8xl font-black text-amber-950 font-[ZCOOL KuaiLe]">å—‘</span>
                        </div>
                        <button onClick={() => setShowSplash(false)} className="bg-amber-950 text-white px-8 py-2 rounded-full shadow-xl">è¿›å…¥ç¤¾åŒº</button>
                    </div>
                );
            }

            // Route Dispatcher
            const renderScreen = () => {
                switch(currentScreen.name) {
                    case 'Main':
                        switch(activeTab) {
                            case 'home': return <HomeTab />;
                            case 'store': return <StoreTab />;
                            case 'social': return <SocialTab />;
                            case 'checkin': return <CheckInTab />;
                            case 'profile': return <ProfileTab />;
                            default: return <HomeTab />;
                        }
                    case 'ProductDetail': return <ProductDetailScreen />;
                    case 'Cart': return <CartScreen />;
                    case 'Checkout': return <CheckoutScreen />;
                    case 'PaySuccess': return <PaySuccessScreen />;
                    case 'Search': return <SearchScreen />;
                    case 'Message': return <MessageScreen />;
                    case 'Chat': return <ChatScreen />;
                    default: return <div className="p-10 text-center">404 Page Not Found</div>;
                }
            };

            return (
                <div className="relative min-h-screen">
                    {renderScreen()}
                    
                    {/* Global Floating Back Button (for sub-pages) */}
                    {canGoBack && currentScreen.name !== 'PaySuccess' && (
                        <button 
                            onClick={goBack}
                            className="fixed bottom-24 right-6 w-12 h-12 bg-white/80 backdrop-blur text-stone-600 rounded-full flex items-center justify-center shadow-lg border border-stone-200 z-50 active:scale-90 transition-transform"
                        >
                            <Icons.ChevronLeft className="w-6 h-6" />
                        </button>
                    )}

                    {/* Bottom Navigation (Only visible on Main screen) */}
                    {currentScreen.name === 'Main' && (
                        <div className="fixed bottom-0 w-full max-w-[480px] bg-white/95 backdrop-blur border-t border-orange-100 pb-safe pt-2 px-2 shadow-[0_-4px_10px_rgba(0,0,0,0.05)] z-40 flex justify-around items-end">
                            {[
                                {id: 'home', l: 'é¦–é¡µ', i: Icons.Home},
                                {id: 'social', l: 'å—‘å‹åœˆ', i: Icons.MessageCircle},
                                {id: 'checkin', l: 'ä»Šæ—¥ä¸€å—‘', i: Icons.Calendar, special: true},
                                {id: 'store', l: 'å•†åŸ', i: Icons.ShoppingBag},
                                {id: 'profile', l: 'æˆ‘çš„', i: Icons.User}
                            ].map(t => {
                                const isActive = activeTab === t.id;
                                if(t.special) {
                                    return (
                                        <div key={t.id} onClick={() => setActiveTab(t.id)} className="relative -top-6">
                                            <div className={`w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-transform active:scale-95 ${isActive ? 'bg-orange-600 scale-110' : 'bg-gradient-to-tr from-orange-400 to-amber-500'}`}>
                                                <t.i className="text-white w-7 h-7" />
                                            </div>
                                            <div className="text-center text-[10px] mt-1 text-stone-500">{t.l}</div>
                                        </div>
                                    )
                                }
                                return (
                                    <div key={t.id} onClick={() => setActiveTab(t.id)} className="flex flex-col items-center w-12 py-1 active:scale-90 transition-transform">
                                        <t.i className={`w-6 h-6 mb-0.5 ${isActive ? 'text-orange-600 stroke-[2.5px]' : 'text-stone-400'}`} />
                                        <span className={`text-[10px] ${isActive ? 'text-orange-600 font-bold' : 'text-stone-400'}`}>{t.l}</span>
                                    </div>
                                )
                            })}
                        </div>
                    )}
                </div>
            );
        };

        const Root = () => <AppProvider><MainApp /></AppProvider>;
        ReactDOM.createRoot(document.getElementById('root')).render(<Root />);
    </script>
</body>
</html>
